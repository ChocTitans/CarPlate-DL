<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>FlaskApp</title>
    <!-- Include Tailwind CSS CDN -->
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
</head>
<body>
    <div class="w-full min-h-screen bg-black text-white">
        <header class="p-4 flex justify-between items-center">
          <div>
            <h1 class="text-2xl font-bold">Police Department</h1>
            {% if location_history %}
                <p class="text-lg" >Location: {{ location_history.street_name }}</p>
            {% else %}
                <p class="text-lg" >No location history found.</p>
            {% endif %}

          </div>
          <div>
            <span
              class="relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full"
              src="/placeholder.svg?height=50&amp;width=50"
            ></span>
          </div>
        </header>
        <main class="p-4">
          <div
            class="rounded-lg border shadow-sm bg-white text-black flex flex-col items-center justify-center"
            data-v0-t="card"
          >
            <div class="flex flex-col space-y-1.5 p-6">
              <h2 class="text-xl font-bold">Highway video</h2>
            </div>
            <div class="p-6 flex flex-col items-center">
                <label for="videoInput" class="flex h-10 items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 w-[180px] text-center" id="fileLabel">
                    <span id="fileLabelText">Choose a video</span>
                    <input type="file" id="videoInput" name="video" accept="video/*" style="display: none;">
                        <path d="m6 9 6 6 6-6"></path>
                    </svg>
                </label>
                <br>
                <button id="uploadButton" class="bg-black text-white items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-primary text-primary-foreground hover:bg-primary/90 h-10 px-4 py-2">
                    Upload Video
                </button>
                <button id="detectButton" class="hidden bg-black text-white items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-primary text-primary-foreground hover:bg-primary/90 h-10 px-4 py-2">
                    Detect Vehicles
                </button>
            </div>
            
          </div>
          <div class="rounded-lg border shadow-sm mt-4 bg-white text-black" data-v0-t="card">
            <div class="flex flex-col space-y-1.5 p-6">
                <h2 class="text-xl font-bold">Matricule Detected</h2>
            </div>
            <div class="p-6">
                <div class="divide-y divide-gray-200">
                    <div class="grid grid-cols-3">
                        <div>ID</div>
                        <div>Matricule</div>
                        <div>Status</div>
                    </div>
                    <br>
                    <!-- Iterate through matricules and display each one -->
                    <div id="vehicleList" >
                        {% for vehicle in vehicles %}
                        <div class="grid grid-cols-3">
                            <div>{{ loop.index }}</div> <!-- Display an index or unique identifier -->
                            <div>{{ vehicle.car_plate }}</div> <!-- Display the matricule -->
                            <div class="inline-flex items-center">
                                {% if vehicle.Status == 'Recherche' %}
                                    <span class="rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 bg-red-500">
                                        {{ vehicle.Status }}
                                    </span>
                                {% else %}
                                    <span class="rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 bg-green-500">
                                        {{ vehicle.Status }}
                                    </span>
                                {% endif %}
                            </div>
                        </div>
                        {% endfor %}
                 </div>
                </div>
            </div>
        </div>
        
          <div class="mt-4">
          </div>
          {% include 'footer.html' %}

        </main>
        
      </div>

      <script>
      document.getElementById('uploadButton').addEventListener('click', function() {
        const input = document.getElementById('videoInput');
        const file = input.files[0];
        if (file) {
            uploadVideo(file);

        
        }
        this.style.display = 'none';
        document.getElementById('videoInput').disabled = true;
        document.getElementById('detectButton').classList.remove('hidden');
        document.getElementById('detectButton').addEventListener('click', function() {
        this.textContent = 'Detecting...';
        });

    });

document.getElementById('detectButton').addEventListener('click', function() {
    const input = document.getElementById('videoInput');
    const file = input.files[0];
    if (file) {
        const formData = new FormData();
        formData.append('video_filename', file.name);

        fetch('/run_detection', {
            method: 'POST',
            body: formData
        })
        .then(response => {
            // Handle the response from the server
            console.log(response);
        })
        .catch(error => {
            // Handle errors
            console.error('Error:', error);
        });
    }
});

function uploadVideo(file) {
    const formData = new FormData();
    formData.append('video', file);

    fetch('/upload_video', {
        method: 'POST',
        body: formData
    })
    .then(response => {
        // Handle the response from the server
        console.log(response);
    })
    .catch(error => {
        // Handle errors
        console.error('Error:', error);
    });
}

document.getElementById('videoInput').addEventListener('change', function() {
    const fileName = this.files[0].name;
    document.getElementById('fileLabelText').textContent = fileName;
});
function fetchUpdatedVehicles() {
    fetch('/api/updated_vehicles')  // Replace with your API endpoint
        .then(response => response.json())
        .then(data => {
            const vehicleList = document.getElementById('vehicleList');
            vehicleList.innerHTML = ''; // Clear the existing list

            data.forEach(vehicle => {
                const vehicleDiv = document.createElement('div');
                vehicleDiv.classList.add('grid', 'grid-cols-3');

                const indexDiv = document.createElement('div');
                indexDiv.textContent = vehicle.index;
                vehicleDiv.appendChild(indexDiv);

                const plateDiv = document.createElement('div');
                plateDiv.textContent = vehicle.car_plate;
                vehicleDiv.appendChild(plateDiv);

                const statusDiv = document.createElement('div');
                const statusSpan = document.createElement('span');
                statusSpan.textContent = vehicle.Status;
                statusSpan.classList.add('rounded-full', 'border', 'px-2.5', 'py-0.5', 'text-xs', 'font-semibold', 'transition-colors', 'focus:outline-none', 'focus:ring-2', 'focus:ring-ring', 'focus:ring-offset-2');
                if (vehicle.Status === 'Recherche') {
                    statusSpan.classList.add('bg-red-500');
                } else {
                    statusSpan.classList.add('bg-green-500');
                }
                statusDiv.appendChild(statusSpan);
                vehicleDiv.appendChild(statusDiv);

                vehicleList.appendChild(vehicleDiv); // Append the new vehicle div to the existing list
            });
        })
        .catch(error => {
            console.error('Error fetching updated vehicles:', error);
        });
}
setInterval(fetchUpdatedVehicles, 5000);  // 5000 milliseconds = 5 seconds

</script>
</body>